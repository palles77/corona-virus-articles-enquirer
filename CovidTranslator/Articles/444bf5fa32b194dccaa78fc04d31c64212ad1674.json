{
    "paper_id": "444bf5fa32b194dccaa78fc04d31c64212ad1674",
    "metadata": {
        "title": "Title: CryoDRGN: Reconstruction of heterogeneous structures from cryo-electron micrographs using neural networks CryoDRGN reveals dynamic continuous motions in the pre-catalytic spliceosome",
        "authors": [
            {
                "first": "Ellen",
                "middle": [
                    "D"
                ],
                "last": "Zhong",
                "suffix": "",
                "affiliation": {},
                "email": ""
            },
            {
                "first": "Tristan",
                "middle": [],
                "last": "Bepler",
                "suffix": "",
                "affiliation": {},
                "email": ""
            },
            {
                "first": "Bonnie",
                "middle": [],
                "last": "Berger",
                "suffix": "",
                "affiliation": {
                    "laboratory": "Computer Science and Artificial Intelligence Laboratory",
                    "institution": "",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Joseph",
                "middle": [
                    "H"
                ],
                "last": "Davis",
                "suffix": "",
                "affiliation": {},
                "email": "jhdavis@mit.edu"
            }
        ]
    },
    "abstract": [
        {
            "text": "Cryo-EM single-particle analysis has proven powerful in determining the structures of rigid macromolecules. However, many protein complexes are flexible and can change conformation and composition as a result of functionally-associated dynamics. Such dynamics are poorly captured by current analysis methods. Here, we present cryoDRGN, an algorithm that for the first time 42 eukaryotic ribosome, the assembling bacterial ribosome, and the pre-catalytic spliceosome 43 complex. In these machines, we discover new conformational states and observe dynamic 44 molecular motions. CryoDRGN is distributed as an open-source tool 22 that can be easily integrated 45 in existing pipelines and is freely available at cryodrgn.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Abstract"
        }
    ],
    "body_text": [
        {
            "text": "leverages the representation power of deep neural networks to efficiently reconstruct highly heterogeneous complexes and continuous trajectories of protein motion. We apply this tool to two synthetic and three publicly available cryo-EM datasets, and we show that cryoDRGN provides an interpretable representation of structural heterogeneity that can be used to identify discrete states as well as continuous conformational changes. This ability enables cryoDRGN to discover previously overlooked structural states and to visualize molecules in motion.",
            "cite_spans": [],
            "ref_spans": [],
            "section": ""
        },
        {
            "text": ". CC-BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Main 1 Single particle cryo-electron microscopy (cryo-EM) is a rapidly maturing method for high-2 resolution structure determination of large macromolecular complexes 1, 2 . Major advances in 3 hardware [3] [4] [5] and software [4] [5] [6] [7] [8] [9] have streamlined the collection and analysis of cryo-EM datasets, such 4 that structures of rigid macromolecules can routinely be solved at near atomic resolution 10, 11 . 5 However, a major computational bottleneck remains when conformational or compositional 6 heterogeneity is present in the sample. 7 The crux of cryo-EM structure determination is the computational task of reconstruction, 8 where algorithms must learn the 3D density or densities from the recorded dataset of 2D particle 9 images 12 . While the standard formulation of reconstruction assumes that each 2D image is 10 generated from a single, static structure, in reality, each image contains a unique snapshot of the 11 molecule of interest. While this heterogeneity complicates reconstruction, it presents an 12 opportunity for single particle cryo-EM to reveal the conformational landscape of dynamic 13 macromolecular complexes. 14 Existing tools for heterogeneous reconstruction often make strong assumptions on the type 15 of heterogeneity in the dataset. Most commonly, heterogeneity is modeled as though it originates 16 from a small number of independent, discrete states [13] [14] [15] [16] , consistent with molecules undergoing 17 cooperative conformational changes. However, because the number of underlying structural states 18 are unknown, such discrete classification approaches are error-prone and often result in the 19 omission of potentially relevant structures. Moreover, this approach fails to model molecules that 20 undergo continuous conformational changes. In these conformationally heterogeneous systems, 21 user-defined masks have been employed to resolve isolated rigid-body motions 17 , but these 22 approaches require assumptions on the types and location of molecular motions. Additionally, new 23 . CC-BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Determination of highly heterogeneous molecular structures 4 theoretical methods have been proposed to model global continuous heterogeneity 18-20 , however 24 no such tools have been made available. 25 Here, we present cryoDRGN (Deep Reconstructing Generative Networks), a cryo-EM 26 reconstruction method that uses a deep neural network to directly approximate the molecule's 27 continuous 3D density function (Fig. 1a) . We designed this tool based on the reasoning that deep 28 neural networks, which are known for their ability to model continuous, nonlinear functions, might 29 effectively capture dynamical structures. We show that this neural network representation of 30 structure, which we call a deep coordinate network, can efficiently learn heterogeneous ensembles 31 of high-resolution structures from single particle cryo-EM datasets 21 . 32 To learn this representation, cryoDRGN introduces an image-encoder/volume-decoder 33 framework to learn a latent representation of heterogeneity from single particle cryo-electron 34 micrographs. Once trained, users can visualize the dataset in the low-dimensional latent space, 35 which we find reflects the structural heterogeneity of the imaged molecule. This structural 36 heterogeneity can then be interrogated by generating 3D density maps at an arbitrary number of 37 desired positions within the latent space, which can be used to visualize continuous structural 38 trajectories. 39 CryoDRGN is a powerful and general approach for analyzing heterogeneity in imaging 40 datasets and can be used to reconstruct both compositionally and conformationally heterogeneous 41 structures. We demonstrate its efficacy by reconstructing and analyzing structures of the . CC-BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the representation of 3D structure from single particle cryo-EM micrographs. In contrast to traditional 50 reconstruction algorithms, which represent the 3D density map on a discretized voxel array, 51 cryoDRGN uses a neural network to predict density as a function of 3D Cartesian coordinates. We 52 call this architecture 23-25 a deep coordinate network. To model heterogeneity, the deep coordinate 53 network can be extended to predict density as a function of both 3D coordinates and continuous 54 latent variables, , which define a n-dimensional manifold of heterogeneous structures (Fig. 1a) . 55 Coordinates are featurized with a positional encoding function before they are input to the deep 56 coordinate network (Methods). This choice of model assumes that structures can be embedded 57 within a continuous low-dimensional space, i.e. the latent space, where the dimensionality of the 58 latent space is defined by the user. 59 To train this neural network representation of 3D structure from a single particle cryo-EM 60 dataset, we develop an encoder-decoder architecture based on the Variational Autoencoder 61 (VAE) 26,27 (Fig. 1b) . The structure is represented in the Fourier domain in order to relate 2D The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Determination of highly heterogeneous molecular structures 6 regularization term on the latent space. The parameters of the neural networks are iteratively 71 updated by gradient descent on this objective function. 72 After training, the encoder network is used to map images into the low-dimensional latent 73 space, where we define \u0302= 0 ( | ) as each image's \"latent encoding\" (Fig. 1c) network produced a structure qualitatively matching the traditional reconstruction ( Fig. 2a) at 84 resolutions up to ~4.0 \u00c5 at an FSC=0.5 threshold (Fig. 2b) . 85 As neural networks have a fixed capacity for representation that is constrained by their 86 architecture, we compared architectures of different sizes to evaluate the tradeoff between 87 representation power and training speed. We found that larger architectures converged to lower 88 values of the objective function (Fig. 2c) and correlated with the traditionally reconstructed map 89 at higher resolution (Fig. 2b) . These improvements in the resulting structure came at the cost of 90 extended training times, suggesting that the architecture and the image size should be tuned to suit 91 the desired balance of training speed and achievable resolution (Supplementary Fig. 1 resulting in a series of 50 distinct but closely-related atomic models. We then generated density 99 maps along this reaction coordinate to serve as the ground truth density maps (Fig. 3a) . Cryo-EM 100 micrographs were generated by projecting the ground truth maps with random poses, followed by 101 application of the contrast transfer function (CTF) and the addition of noise (see Methods). To 102 simulate a compositionally heterogeneous dataset, this procedure was repeated by mixing images 103 generated from the bacterial 30S, 50S, and 70S ribosomal density maps (Fig. 3d) . The cryoDRGN 104 networks were then provided these simulated images and their corresponding poses, and were 105 trained with 1-dimensional (1D) latent variable models. 106 When trained on the dataset with continuous heterogeneity, we found that cryoDRGN 107 accurately modeled the full continuum of structures as assessed by two criteria. First, the latent 108 encoding of each image produced by the encoder network correlated well with the dihedral angle 109 of the underlying model (Spearman = \u22120.996), which we characterize as the ground truth 110 reaction coordinate (Fig. 3b) . Second, when provided a series of latent variable values, the deep 111 coordinate network produced structures that correlated with the ground-truth maps (Fig. 3c) . We 112 note that the deep coordinate network can generate an arbitrary number of conformations along 113 the trajectory, and found that for 100 images equally spaced along the reaction coordinate, the 114 generated structure at each image's predicted latent encoding correlated well with its ground truth 115 map (Supplementary Fig. 2) . 116 . CC-BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Determination of highly heterogeneous molecular structures 8 When cryoDRGN was trained on the compositionally heterogeneous dataset, we observed 117 that the encoder network mapped particles to three distinct clusters in latent space (Fig. 3e) . These 118 clusters aligned with the ground truth class assignments from the 30S, 50S, and 70S ribosome 119 (classification accuracy of 99.9%), and the appropriate ribosomal structures were generated by the 120 deep coordinate network when provided with latent variable values at the corresponding cluster 121 centers (Fig. 3f, Supplementary Fig. 2) . 122 CryoDRGN uncovers residual heterogeneity in a high-resolution cryo-EM reconstruction 123 We next evaluated cryoDRGN's ability to learn heterogeneous structures from real cryo-124 EM data, which contains structured noise and imaging artifacts that are difficult to simulate. When (Fig. 4a) and observed a subset of particles separated along 132 PC1. A density map generated by the deep coordinate network from this region of latent space 133 revealed a distinct conformation of the 40S subunit, which was rotated relative to the 60S subunit 134 (Fig. 4b,c) . Concomitant with the inter-subunit rotation, we observed the disappearance of the The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Pf40S head group, those missing the head group, and those with clearly resolved rRNA helices 140 that were absent from the homogeneous reconstruction (Fig. 4c) . 141 CryoDRGN automatically partitions assembly states of the bacterial ribosome 142 Next, we assessed cryoDRGN's ability to analyze and reconstruct density maps from a 143 dataset known to contain substantial compositional and conformational heterogeneity. For this 144 assessment, we investigated a highly heterogeneous mixture of assembly intermediates of the E. To assess the degree of heterogeneity in the data, we first trained a 1D latent variable model 157 on down-sampled images (D=128, Nyquist limit of 6.6 \u00c5) using image poses from a consensus 158 reconstruction. After model training, the encoder network was used to predict the latent encoding 159 for each particle, and the resulting histogram of the full dataset's encodings revealed five distinct 160 peaks. Four of the peaks corresponded to each of the four major classes of the LSU, and the fifth 161 peak near = \u22122 captured particles that were unassigned by Davis et al. (Fig. 5a) The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint supervision. When using the subset of particles from this region (assigned \u2264 \u22121), neither 2D 164 class averages nor a traditional 3D reconstruction produced structures consistent with assembling 165 ribosomes ( Supplementary Fig. 3 ). As we do not wish to model these impurities, we filtered the 166 dataset by the latent variable, keeping 101,604 images with > \u22121 for further analysis. 167 To explore the heterogeneity within these major assembly states, we trained a 10D latent 168 variable model on the remaining high-resolution images (D=256, Nyquist limit of 3.3 \u00c5). We 169 visualized the resulting 10D latent encodings using UMAP 33 , and observed particle super-clusters (Fig. 6a) . After sampling structures from the latent space, we observed expected spliceosome 194 conformations from the largest cluster, poorly resolved structures from the leftmost cluster, 195 structures lacking density for the SF3b domain from a third cluster, and additional density 196 consistent with particle aggregation from the uppermost cluster (Fig. 6b) . To focus our analysis 197 on bone-fide pre-catalytic spliceosome particles, we leveraged the latent space representation to 198 eliminate any particles that mapped to the undesired clusters from two replicate runs, which 199 resulted in a final particle stack of 150,098 images. 200 With the filtered particle stack, we trained a 10D model on higher resolution images 201 (D=256, Nyquist limit of 3.4 \u00c5), and visualized the dataset's latent encodings in 2D using PCA 202 and UMAP (Fig. 6a,c) . The visualized data manifold was unfeatured, consistent with a molecule The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint required for 3D classification. Finally, when analyzing the pre-catalytic spliceosome, we found 235 that the continuous conformational changes cryoDRGN reconstructed lack the rigid-body 236 boundary artifacts introduced from multibody refinement's mask-based approach 17 . 237 Interpretation of the latent space 238 A key feature of cryoDRGN is its ability to provide a low-dimensional representation of 239 the dataset's heterogeneity, which is given by each particle's latent encoding. Subject to 240 optimization, cryoDRGN organizes the latent space such that structurally related particles are in 241 close proximity. Thus, visualization of the distribution of latent encodings can be informative in 242 understanding the structural heterogeneity within the imaged ensemble. In both simulated and real 243 datasets we find that continuous motions are embedded along a continuum in latent space ( Fig.   244 3b, 6c) and that compositionally distinct states manifest as clusters (Fig. 3e, 5b) . This observation 245 suggests an interpretation of the latent encodings as an approximate conformational landscape, 246 with regions of high-particle occupancy corresponding to low-energy states, and regions of lower-247 particle occupancy denoting higher energy states. We note however that structures reconstructed 248 from unoccupied regions will not in general correspond to true physical intermediates, as 249 cryoDRGN optimizes the likelihood of the observed data and these intermediates are not observed. 250 Finally, in real datasets, there may exist images that do not originate from the standard single 251 particle image formation model, for example, false positives encountered during particle picking 9 . 252 We demonstrated the utility of the latent space encodings in identifying such impurities, ice 253 artifacts, and other such out-of-distribution particles that may be filtered out in subsequent analyses 254 (Fig. 5a, 6a) . 1,2,3,4) . 265 Practical considerations in choosing training hyperparameters 266 Although this method emphasizes an unsupervised approach to analyzing structural 267 heterogeneity, cryoDRGN does require that the user define the dimensionality of the latent space 268 and the architecture of both the encoder and decoder networks. We find that in practice, a 1D latent 269 space is effective at distinguishing bona-fide particles from contaminants and imaging artifacts 270 (Fig. 5a) , and we recommend users initially employ such a model to filter their dataset. 271 Additionally, we find that in our tested datasets, a 10D latent space provides sufficient 272 representation capacity to effectively model structural heterogeneity, and that this 10D space can 273 be readily visualized with PCA or UMAP. Notably, we recommend the use of such as 10D latent 274 space instead of lower dimensional space as we have found that 10D spaces result in much more 275 rapid overall training, which is consistent with similar observations of related overparameterized 276 neural network architectures 37,38 . Finally, users must specify the number of nodes and layers in the 277 neural networks. Here, we find an inverse relationship between neural network size and the 278 achievable resolution of a given structure (Supplemental Fig. 1) . Training larger networks on 279 larger images is significantly slower, and we recommend that users perform an initial assessment 280 using down-sampled images and relatively small networks before proceeding to high-resolution 281 reconstructions.",
            "cite_spans": [
                {
                    "start": 231,
                    "end": 232,
                    "text": "1",
                    "ref_id": null
                },
                {
                    "start": 393,
                    "end": 395,
                    "text": "1,",
                    "ref_id": null
                },
                {
                    "start": 396,
                    "end": 397,
                    "text": "2",
                    "ref_id": null
                },
                {
                    "start": 418,
                    "end": 419,
                    "text": "3",
                    "ref_id": null
                },
                {
                    "start": 429,
                    "end": 432,
                    "text": "[3]",
                    "ref_id": null
                },
                {
                    "start": 433,
                    "end": 436,
                    "text": "[4]",
                    "ref_id": "BIBREF6"
                },
                {
                    "start": 437,
                    "end": 440,
                    "text": "[5]",
                    "ref_id": "BIBREF7"
                },
                {
                    "start": 454,
                    "end": 457,
                    "text": "[4]",
                    "ref_id": "BIBREF6"
                },
                {
                    "start": 458,
                    "end": 461,
                    "text": "[5]",
                    "ref_id": "BIBREF7"
                },
                {
                    "start": 462,
                    "end": 465,
                    "text": "[6]",
                    "ref_id": "BIBREF8"
                },
                {
                    "start": 466,
                    "end": 469,
                    "text": "[7]",
                    "ref_id": "BIBREF9"
                },
                {
                    "start": 470,
                    "end": 473,
                    "text": "[8]",
                    "ref_id": null
                },
                {
                    "start": 474,
                    "end": 477,
                    "text": "[9]",
                    "ref_id": "BIBREF12"
                },
                {
                    "start": 641,
                    "end": 644,
                    "text": "10,",
                    "ref_id": "BIBREF13"
                },
                {
                    "start": 872,
                    "end": 873,
                    "text": "8",
                    "ref_id": null
                },
                {
                    "start": 1630,
                    "end": 1634,
                    "text": "[13]",
                    "ref_id": "BIBREF16"
                },
                {
                    "start": 1635,
                    "end": 1639,
                    "text": "[14]",
                    "ref_id": "BIBREF17"
                },
                {
                    "start": 1640,
                    "end": 1644,
                    "text": "[15]",
                    "ref_id": "BIBREF18"
                },
                {
                    "start": 1645,
                    "end": 1649,
                    "text": "[16]",
                    "ref_id": "BIBREF19"
                },
                {
                    "start": 1788,
                    "end": 1790,
                    "text": "18",
                    "ref_id": null
                },
                {
                    "start": 1884,
                    "end": 1886,
                    "text": "19",
                    "ref_id": null
                },
                {
                    "start": 2081,
                    "end": 2083,
                    "text": "21",
                    "ref_id": null
                },
                {
                    "start": 2276,
                    "end": 2278,
                    "text": "23",
                    "ref_id": null
                },
                {
                    "start": 2705,
                    "end": 2707,
                    "text": "25",
                    "ref_id": null
                },
                {
                    "start": 2787,
                    "end": 2789,
                    "text": "26",
                    "ref_id": null
                },
                {
                    "start": 2984,
                    "end": 2986,
                    "text": "28",
                    "ref_id": null
                },
                {
                    "start": 3086,
                    "end": 3088,
                    "text": "29",
                    "ref_id": null
                },
                {
                    "start": 3354,
                    "end": 3356,
                    "text": "21",
                    "ref_id": null
                },
                {
                    "start": 3359,
                    "end": 3361,
                    "text": "32",
                    "ref_id": null
                },
                {
                    "start": 3444,
                    "end": 3446,
                    "text": "33",
                    "ref_id": null
                },
                {
                    "start": 3641,
                    "end": 3643,
                    "text": "35",
                    "ref_id": null
                },
                {
                    "start": 3736,
                    "end": 3738,
                    "text": "36",
                    "ref_id": null
                },
                {
                    "start": 3933,
                    "end": 3935,
                    "text": "38",
                    "ref_id": null
                },
                {
                    "start": 3950,
                    "end": 3952,
                    "text": "39",
                    "ref_id": null
                },
                {
                    "start": 4036,
                    "end": 4038,
                    "text": "40",
                    "ref_id": null
                },
                {
                    "start": 4984,
                    "end": 4986,
                    "text": "55",
                    "ref_id": null
                },
                {
                    "start": 5319,
                    "end": 5321,
                    "text": "59",
                    "ref_id": null
                },
                {
                    "start": 5962,
                    "end": 5964,
                    "text": "72",
                    "ref_id": null
                },
                {
                    "start": 6297,
                    "end": 6299,
                    "text": "85",
                    "ref_id": null
                },
                {
                    "start": 7729,
                    "end": 7732,
                    "text": "106",
                    "ref_id": null
                },
                {
                    "start": 8647,
                    "end": 8650,
                    "text": "116",
                    "ref_id": null
                },
                {
                    "start": 9474,
                    "end": 9477,
                    "text": "122",
                    "ref_id": null
                },
                {
                    "start": 9563,
                    "end": 9566,
                    "text": "123",
                    "ref_id": null
                },
                {
                    "start": 10422,
                    "end": 10425,
                    "text": "141",
                    "ref_id": null
                },
                {
                    "start": 10502,
                    "end": 10505,
                    "text": "142",
                    "ref_id": null
                },
                {
                    "start": 11184,
                    "end": 11187,
                    "text": "160",
                    "ref_id": null
                },
                {
                    "start": 11900,
                    "end": 11903,
                    "text": "167",
                    "ref_id": null
                },
                {
                    "start": 12383,
                    "end": 12386,
                    "text": "195",
                    "ref_id": null
                },
                {
                    "start": 12683,
                    "end": 12686,
                    "text": "198",
                    "ref_id": null
                },
                {
                    "start": 12838,
                    "end": 12841,
                    "text": "200",
                    "ref_id": null
                },
                {
                    "start": 13026,
                    "end": 13029,
                    "text": "202",
                    "ref_id": null
                },
                {
                    "start": 13540,
                    "end": 13543,
                    "text": "237",
                    "ref_id": null
                },
                {
                    "start": 13579,
                    "end": 13582,
                    "text": "238",
                    "ref_id": null
                },
                {
                    "start": 14281,
                    "end": 14284,
                    "text": "245",
                    "ref_id": null
                },
                {
                    "start": 14380,
                    "end": 14383,
                    "text": "246",
                    "ref_id": null
                },
                {
                    "start": 14776,
                    "end": 14779,
                    "text": "250",
                    "ref_id": null
                },
                {
                    "start": 14982,
                    "end": 14985,
                    "text": "252",
                    "ref_id": null
                },
                {
                    "start": 15219,
                    "end": 15222,
                    "text": "265",
                    "ref_id": null
                },
                {
                    "start": 15285,
                    "end": 15288,
                    "text": "266",
                    "ref_id": null
                },
                {
                    "start": 15771,
                    "end": 15774,
                    "text": "271",
                    "ref_id": null
                },
                {
                    "start": 15865,
                    "end": 15868,
                    "text": "272",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 2917,
                    "end": 2926,
                    "text": "(Fig. 1a)",
                    "ref_id": "FIGREF14"
                },
                {
                    "start": 4972,
                    "end": 4981,
                    "text": "(Fig. 1a)",
                    "ref_id": "FIGREF14"
                },
                {
                    "start": 5520,
                    "end": 5529,
                    "text": "(Fig. 1b)",
                    "ref_id": "FIGREF14"
                },
                {
                    "start": 6126,
                    "end": 6135,
                    "text": "(Fig. 1c)",
                    "ref_id": "FIGREF14"
                },
                {
                    "start": 6221,
                    "end": 6229,
                    "text": "Fig. 2a)",
                    "ref_id": null
                },
                {
                    "start": 6285,
                    "end": 6294,
                    "text": "(Fig. 2b)",
                    "ref_id": null
                },
                {
                    "start": 6618,
                    "end": 6627,
                    "text": "(Fig. 2c)",
                    "ref_id": null
                },
                {
                    "start": 6708,
                    "end": 6717,
                    "text": "(Fig. 2b)",
                    "ref_id": null
                },
                {
                    "start": 6957,
                    "end": 6978,
                    "text": "(Supplementary Fig. 1",
                    "ref_id": "FIGREF14"
                },
                {
                    "start": 7158,
                    "end": 7167,
                    "text": "(Fig. 3a)",
                    "ref_id": null
                },
                {
                    "start": 7549,
                    "end": 7558,
                    "text": "(Fig. 3d)",
                    "ref_id": null
                },
                {
                    "start": 8132,
                    "end": 8141,
                    "text": "(Fig. 3b)",
                    "ref_id": null
                },
                {
                    "start": 8297,
                    "end": 8306,
                    "text": "(Fig. 3c)",
                    "ref_id": null
                },
                {
                    "start": 8622,
                    "end": 8644,
                    "text": "(Supplementary Fig. 2)",
                    "ref_id": null
                },
                {
                    "start": 9111,
                    "end": 9120,
                    "text": "(Fig. 3e)",
                    "ref_id": null
                },
                {
                    "start": 9440,
                    "end": 9471,
                    "text": "(Fig. 3f, Supplementary Fig. 2)",
                    "ref_id": null
                },
                {
                    "start": 9757,
                    "end": 9766,
                    "text": "(Fig. 4a)",
                    "ref_id": null
                },
                {
                    "start": 10022,
                    "end": 10033,
                    "text": "(Fig. 4b,c)",
                    "ref_id": null
                },
                {
                    "start": 10410,
                    "end": 10419,
                    "text": "(Fig. 4c)",
                    "ref_id": null
                },
                {
                    "start": 11361,
                    "end": 11370,
                    "text": "(Fig. 5a)",
                    "ref_id": null
                },
                {
                    "start": 11724,
                    "end": 11744,
                    "text": "Supplementary Fig. 3",
                    "ref_id": null
                },
                {
                    "start": 12191,
                    "end": 12200,
                    "text": "(Fig. 6a)",
                    "ref_id": null
                },
                {
                    "start": 12547,
                    "end": 12556,
                    "text": "(Fig. 6b)",
                    "ref_id": null
                },
                {
                    "start": 13039,
                    "end": 13050,
                    "text": "(Fig. 6a,c)",
                    "ref_id": null
                },
                {
                    "start": 14167,
                    "end": 14177,
                    "text": "Fig.   244",
                    "ref_id": null
                },
                {
                    "start": 14248,
                    "end": 14261,
                    "text": "(Fig. 3e, 5b)",
                    "ref_id": null
                },
                {
                    "start": 15192,
                    "end": 15205,
                    "text": "(Fig. 5a, 6a)",
                    "ref_id": null
                },
                {
                    "start": 15208,
                    "end": 15216,
                    "text": "1,2,3,4)",
                    "ref_id": "FIGREF14"
                },
                {
                    "start": 15681,
                    "end": 15690,
                    "text": "(Fig. 5a)",
                    "ref_id": null
                },
                {
                    "start": 16514,
                    "end": 16535,
                    "text": "(Supplemental Fig. 1)",
                    "ref_id": "FIGREF14"
                }
            ],
            "section": ""
        },
        {
            "text": ". CC-BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint",
            "cite_spans": [],
            "ref_spans": [],
            "section": "282"
        },
        {
            "text": "Discovering new states using cryoDRGN 283 CryoDRGN can be used to identify novel clusters of structurally-related particles, which 284 can then be visualized by sampling a 3D structure from that region of latent space. Indeed, in 285 analyzing the bL17-depleted LSU assembly dataset, we noted a completely new structural class, 286 which like the C-classes, lacked the central protuberance, but like the most mature E classes, 287 clearly bore a functionally critical inter-subunit helix (h68). This state was completely missed in 288 traditional hierarchical classification 32 , and provides structural evidence that this vital intersubunit 289 helix can dock in a native conformation in the absence of the central protuberance 290 (Supplementary Fig. 6) . Notably, we could validate the existence of this class by performing 291 traditional back-projection using ~1,000 particles from this cluster (Supplementary Fig. 6 ). 292 In future work, we envision using cryoDRGN to reveal the number of discrete classes, their 293 constituent particles, and to produce initial 3D models that could be used as inputs for a traditional 294 3D reconstruction. Given the mature state of such tools 39,40 , this unbiased classification approach 295 followed by traditional homogeneous reconstruction, particle polishing, and higher order image 296 aberration correction, has the potential to produce very high-resolution structures of the full 297 spectrum of discrete structural states without the need for expert-guided classification. 298 Fully unsupervised 3D reconstruction 299 As implemented, cryoDRGN uses pose estimates resulting from a traditional consensus 3D 300 reconstruction. In analyzing three publicly available datasets, we found that such consensus pose 301 estimates were sufficiently accurate to generate meaningful latent space encodings and to produce 302 interpretable density maps of distinct structures. It is clear, however, that this approach will fail if 303 the degree of structural heterogeneity in the dataset results in inaccurate pose estimates. For 304 example, a mixture of structurally unrelated complexes will align poorly to a consensus structure, 305 and thus produce poor pose estimates. Notably, our framework is differentiable with respect to 306 . CC-BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint pose variables, which, in principle, should allow for on-the-fly pose-refinement or de novo pose 307 estimation 25 , and future work will explore the efficacy of incorporating such features. The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Analysis: After training, the dataset's latent encoding was viewed in 2D with UMAP ( Fig.   502 6a) and PCA (Fig. 6c) . Density maps in Figure 6d were generated at the latent encoding values 503 that traverse PC1 at five equally spaced points between the 5 th and 95 th percentile of PC1 values. 504 Density maps in Extended Fig. 7 were generated at the latent encoding values that traverse PC2 at 505 five equally spaced points between the 5 th and 95 th percentile of PC2 values. The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint",
            "cite_spans": [
                {
                    "start": 38,
                    "end": 41,
                    "text": "283",
                    "ref_id": null
                },
                {
                    "start": 230,
                    "end": 233,
                    "text": "285",
                    "ref_id": null
                },
                {
                    "start": 328,
                    "end": 331,
                    "text": "286",
                    "ref_id": null
                },
                {
                    "start": 427,
                    "end": 430,
                    "text": "287",
                    "ref_id": null
                },
                {
                    "start": 925,
                    "end": 928,
                    "text": "292",
                    "ref_id": null
                },
                {
                    "start": 1526,
                    "end": 1529,
                    "text": "298",
                    "ref_id": null
                },
                {
                    "start": 1567,
                    "end": 1570,
                    "text": "299",
                    "ref_id": null
                },
                {
                    "start": 2174,
                    "end": 2177,
                    "text": "305",
                    "ref_id": null
                },
                {
                    "start": 3132,
                    "end": 3135,
                    "text": "504",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 733,
                    "end": 755,
                    "text": "(Supplementary Fig. 6)",
                    "ref_id": null
                },
                {
                    "start": 900,
                    "end": 921,
                    "text": "(Supplementary Fig. 6",
                    "ref_id": null
                },
                {
                    "start": 2921,
                    "end": 2931,
                    "text": "Fig.   502",
                    "ref_id": null
                },
                {
                    "start": 2944,
                    "end": 2953,
                    "text": "(Fig. 6c)",
                    "ref_id": null
                },
                {
                    "start": 2972,
                    "end": 2981,
                    "text": "Figure 6d",
                    "ref_id": null
                },
                {
                    "start": 3161,
                    "end": 3167,
                    "text": "Fig. 7",
                    "ref_id": null
                }
            ],
            "section": "282"
        }
    ],
    "bib_entries": {
        "BIBREF0": {
            "ref_id": "b0",
            "title": "The development of cryo-EM into a mainstream structural biology technique",
            "authors": [
                {
                    "first": "E",
                    "middle": [],
                    "last": "Nogales",
                    "suffix": ""
                }
            ],
            "year": 2016,
            "venue": "Nat. Methods",
            "volume": "13",
            "issn": "",
            "pages": "24--27",
            "other_ids": {}
        },
        "BIBREF1": {
            "ref_id": "b1",
            "title": "Single-particle cryo-EM-How did it get here and where will it go",
            "authors": [
                {
                    "first": "Y",
                    "middle": [],
                    "last": "Cheng",
                    "suffix": ""
                }
            ],
            "year": 2018,
            "venue": "Science",
            "volume": "361",
            "issn": "",
            "pages": "876--880",
            "other_ids": {}
        },
        "BIBREF2": {
            "ref_id": "b2",
            "title": "Direct electron detection yields cryo-EM reconstructions at resolutions beyond 3/4 Nyquist frequency",
            "authors": [
                {
                    "first": "B",
                    "middle": [
                        "E"
                    ],
                    "last": "Bammes",
                    "suffix": ""
                },
                {
                    "first": "R",
                    "middle": [
                        "H"
                    ],
                    "last": "Rochat",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [],
                    "last": "Jakana",
                    "suffix": ""
                },
                {
                    "first": "D.-H",
                    "middle": [],
                    "last": "Chen",
                    "suffix": ""
                },
                {
                    "first": "W",
                    "middle": [],
                    "last": "Chiu",
                    "suffix": ""
                }
            ],
            "year": 2012,
            "venue": "J. Struct. Biol",
            "volume": "177",
            "issn": "",
            "pages": "589--601",
            "other_ids": {}
        },
        "BIBREF3": {
            "ref_id": "b3",
            "title": "CocoNet: A deep neural network for mapping pixel coordinates to color values",
            "authors": [
                {
                    "first": "P",
                    "middle": [
                        "A"
                    ],
                    "last": "Bricman",
                    "suffix": ""
                },
                {
                    "first": "R",
                    "middle": [
                        "T"
                    ],
                    "last": "Ionescu",
                    "suffix": ""
                }
            ],
            "year": 2018,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF4": {
            "ref_id": "b4",
            "title": "Explicitly disentangling image content from translation and rotation with spatial-VAE",
            "authors": [
                {
                    "first": "T",
                    "middle": [],
                    "last": "Bepler",
                    "suffix": ""
                },
                {
                    "first": "E",
                    "middle": [],
                    "last": "Zhong",
                    "suffix": ""
                },
                {
                    "first": "K",
                    "middle": [],
                    "last": "Kelley",
                    "suffix": ""
                },
                {
                    "first": "E",
                    "middle": [],
                    "last": "Brignole",
                    "suffix": ""
                },
                {
                    "first": "B",
                    "middle": [],
                    "last": "Berger",
                    "suffix": ""
                }
            ],
            "year": 2019,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "15435--15445",
            "other_ids": {}
        },
        "BIBREF5": {
            "ref_id": "b5",
            "title": "Reconstructing continuous distributions of 3D protein structure from cryo-EM images",
            "authors": [
                {
                    "first": "E",
                    "middle": [
                        "D"
                    ],
                    "last": "Zhong",
                    "suffix": ""
                },
                {
                    "first": "T",
                    "middle": [],
                    "last": "Bepler",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [
                        "H"
                    ],
                    "last": "Davis",
                    "suffix": ""
                },
                {
                    "first": "B",
                    "middle": [],
                    "last": "Berger",
                    "suffix": ""
                }
            ],
            "year": 2019,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF6": {
            "ref_id": "b6",
            "title": "Auto-Encoding Variational Bayes",
            "authors": [
                {
                    "first": "D",
                    "middle": [
                        "P"
                    ],
                    "last": "Kingma",
                    "suffix": ""
                },
                {
                    "first": "M",
                    "middle": [],
                    "last": "Welling",
                    "suffix": ""
                }
            ],
            "year": 2013,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF7": {
            "ref_id": "b7",
            "title": "Stochastic Backpropagation and Approximate Inference in Deep Generative Models",
            "authors": [
                {
                    "first": "D",
                    "middle": [
                        "J"
                    ],
                    "last": "Rezende",
                    "suffix": ""
                },
                {
                    "first": "S",
                    "middle": [],
                    "last": "Mohamed",
                    "suffix": ""
                },
                {
                    "first": "D",
                    "middle": [],
                    "last": "Wierstra",
                    "suffix": ""
                }
            ],
            "year": 2014,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF8": {
            "ref_id": "b8",
            "title": "Strip Integration in Radio Astronomy",
            "authors": [
                {
                    "first": "R",
                    "middle": [
                        "N"
                    ],
                    "last": "Bracewell",
                    "suffix": ""
                }
            ],
            "year": 1956,
            "venue": "Aust. J. Phys",
            "volume": "9",
            "issn": "",
            "pages": "198--217",
            "other_ids": {}
        },
        "BIBREF9": {
            "ref_id": "b9",
            "title": "The PyMOL Molecular Graphics System",
            "authors": [
                {
                    "first": "Llc",
                    "middle": [],
                    "last": "Schr\u00f6dinger",
                    "suffix": ""
                }
            ],
            "year": null,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF10": {
            "ref_id": "b10",
            "title": "International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the",
            "authors": [
                {
                    "first": "",
                    "middle": [],
                    "last": "Cc-By-Nc-Nd",
                    "suffix": ""
                }
            ],
            "year": null,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {
                "DOI": [
                    "10.1101/2020.03.27.003871"
                ]
            }
        },
        "BIBREF11": {
            "ref_id": "b11",
            "title": "UCSF Chimera-A visualization system for exploratory research and analysis",
            "authors": [
                {
                    "first": "E",
                    "middle": [
                        "F"
                    ],
                    "last": "Pettersen",
                    "suffix": ""
                }
            ],
            "year": 2004,
            "venue": "Journal of Computational Chemistry",
            "volume": "25",
            "issn": "",
            "pages": "1605--1612",
            "other_ids": {}
        },
        "BIBREF12": {
            "ref_id": "b12",
            "title": "EMPIAR: a public archive for raw electron microscopy image data",
            "authors": [
                {
                    "first": "A",
                    "middle": [],
                    "last": "Iudin",
                    "suffix": ""
                },
                {
                    "first": "P",
                    "middle": [
                        "K"
                    ],
                    "last": "Korir",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [],
                    "last": "Salavert-Torres",
                    "suffix": ""
                },
                {
                    "first": "G",
                    "middle": [
                        "J"
                    ],
                    "last": "Kleywegt",
                    "suffix": ""
                },
                {
                    "first": "A",
                    "middle": [],
                    "last": "Patwardhan",
                    "suffix": ""
                }
            ],
            "year": 2016,
            "venue": "Nat. Methods",
            "volume": "13",
            "issn": "",
            "pages": "387--388",
            "other_ids": {}
        },
        "BIBREF13": {
            "ref_id": "b13",
            "title": "cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination",
            "authors": [
                {
                    "first": "A",
                    "middle": [],
                    "last": "Punjani",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [
                        "L"
                    ],
                    "last": "Rubinstein",
                    "suffix": ""
                },
                {
                    "first": "D",
                    "middle": [
                        "J"
                    ],
                    "last": "Fleet",
                    "suffix": ""
                },
                {
                    "first": "M",
                    "middle": [
                        "A"
                    ],
                    "last": "Brubaker",
                    "suffix": ""
                }
            ],
            "year": 2017,
            "venue": "Nat. Methods",
            "volume": "14",
            "issn": "",
            "pages": "290--296",
            "other_ids": {}
        },
        "BIBREF14": {
            "ref_id": "b14",
            "title": "Optimal determination of particle orientation, absolute hand, and contrast loss in single-particle electron cryomicroscopy",
            "authors": [
                {
                    "first": "P",
                    "middle": [
                        "B"
                    ],
                    "last": "Rosenthal",
                    "suffix": ""
                },
                {
                    "first": "R",
                    "middle": [],
                    "last": "Henderson",
                    "suffix": ""
                }
            ],
            "year": 2003,
            "venue": "J. Mol. Biol",
            "volume": "333",
            "issn": "",
            "pages": "721--745",
            "other_ids": {}
        },
        "BIBREF15": {
            "ref_id": "b15",
            "title": "A Method for Stochastic Optimization",
            "authors": [
                {
                    "first": "D",
                    "middle": [
                        "P"
                    ],
                    "last": "Kingma",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [],
                    "last": "Ba",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Adam",
                    "suffix": ""
                }
            ],
            "year": 2014,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF16": {
            "ref_id": "b16",
            "title": "Cryo-EM structure of the Plasmodium falciparum 80S ribosome bound to the anti-protozoan drug emetine",
            "authors": [
                {
                    "first": "W",
                    "middle": [],
                    "last": "Wong",
                    "suffix": ""
                }
            ],
            "year": 2014,
            "venue": "Elife",
            "volume": "3",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF17": {
            "ref_id": "b17",
            "title": "Scikit-learn: Machine Learning in Python",
            "authors": [
                {
                    "first": "F",
                    "middle": [],
                    "last": "Pedregosa",
                    "suffix": ""
                }
            ],
            "year": 2011,
            "venue": "Journal of Machine Learning Research",
            "volume": "12",
            "issn": "",
            "pages": "2825--2830",
            "other_ids": {}
        },
        "BIBREF18": {
            "ref_id": "b18",
            "title": "UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction",
            "authors": [
                {
                    "first": "L",
                    "middle": [],
                    "last": "Mcinnes",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [],
                    "last": "Healy",
                    "suffix": ""
                },
                {
                    "first": "J",
                    "middle": [],
                    "last": "Melville",
                    "suffix": ""
                }
            ],
            "year": 2018,
            "venue": "arxiv.org",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF19": {
            "ref_id": "b19",
            "title": "PyTorch: An Imperative Style, High-Performance Deep Learning Library",
            "authors": [
                {
                    "first": "A",
                    "middle": [],
                    "last": "Paszke",
                    "suffix": ""
                }
            ],
            "year": 2019,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "8026--8037",
            "other_ids": {}
        },
        "BIBREF20": {
            "ref_id": "b20",
            "title": "International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the",
            "authors": [
                {
                    "first": "",
                    "middle": [],
                    "last": "Cc-By-Nc-Nd",
                    "suffix": ""
                }
            ],
            "year": null,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {
                "DOI": [
                    "10.1101/2020.03.27.003871"
                ]
            }
        }
    },
    "ref_entries": {
        "FIGREF0": {
            "text": "62 images as central slices out of a density map according to the Fourier slice theorem 28 . For a given 63 image, , the encoder neural network predicts a distribution of possible latent variable values, 64 ( | ). The image's oriented 3D pixel coordinates are computed from the image's pose 65 assignment provided by a previously determined consensus reconstruction. Then, given a sample 66 from the encoder distribution ~ ( | ) and the 3D coordinates of the slice, the image is 67 reconstructed pixel-by-pixel through the deep coordinate network. The networks are trained jointly 68 using an objective function that seeks to optimize a variational upper bound on the data likelihood 69 as in standard VAEs 25 . This objective function consists of the image reconstruction error and",
            "latex": null,
            "type": "figure"
        },
        "FIGREF1": {
            "text": "reconstruction of the Pf80S ribosome, Wong et al. observed flexibility 126 in the small subunit head region and missing density for peripheral rRNA expansion segment 127 elements that prevented completion of an atomic model in these regions 29 . To explore if this 128 unresolved density resulted from residual heterogeneity, we trained a 10-dimensional (10D) latent 129 variable model with cryoDRGN on their deposited dataset (EMPIAR-10028), using poses from a 130 consensus reconstruction in cryoSPARC 30 . We then visualized the dataset's latent encodings using 131 principal component analysis (PCA)",
            "latex": null,
            "type": "figure"
        },
        "FIGREF2": {
            "text": "135inter-subunit bridge formed by the C-terminal helix of eL8, which is consistent with Sun et al.'s 136 characterization of Pf80S dynamics 31 . We further explored structural heterogeneity by performing 137 k-means clustering of the latent encodings with k=20 clusters and subsequently generating 138 structures at the cluster centers. We observed diverse structures including those bearing a",
            "latex": null,
            "type": "figure"
        },
        "FIGREF3": {
            "text": "145 coli large ribosomal subunit (LSU). This dataset (EMPIAR 10076) had previously been analyzed 146 through multiple expert-guided rounds of hierarchical 3D classification resulting in 13 discrete 147 structures that were grouped into 4 major classes 32 . These particles were obtained by crudely 148 fractionating a lysate with the explicit goal of imaging and later analyzing the full ensemble of 149 cellular assembly intermediates. As such, a substantial fraction of the published particle stack 150 corresponds to non-ribosomal impurities that were discarded during 3D classification in the 151 original analysis (26,575 out of 131,899 images). Despite this heterogeneity, a homogeneous 152 reconstruction of the full dataset produced a consensus structure of the mature LSU (GSFSC 153 resolution of 3.2 \u00c5), suggesting that even in the presence of these impurities, the heterogeneous 154 ribosomal particles could be aligned to the rigid core of the LSU, which enabled analysis",
            "latex": null,
            "type": "figure"
        },
        "FIGREF4": {
            "text": "32 . This clear 162 separation in latent space suggested that cryoDRGN can identify sample impurities",
            "latex": null,
            "type": "figure"
        },
        "FIGREF5": {
            "text": "170corresponding to major classes of LSU assembly(Fig. 5b)and sub-clusters that aligned with Davis 171 et al.'s minor class assignments(Supplementary Fig. 4) 32 . We found that when provided latent 172 codes from these clusters, the decoder network generated structures matching the major(Fig. 5c)173    and minor(Supplementary Fig. 5) assembly states of the LSU. With the 10D latent variable 174 model, we also noted a clearly separated cluster of particles assigned to class A, and structures 175 sampled from this region of latent space reconstructed the 70S ribosome, an impurity in the dataset 176 (Supplementary Fig. 6). Finally, we identified a small cluster of ~1,200 particles in latent space 177 adjacent to the class C cluster whose particles were classified into class E by Davis et al.178    (Supplementary Fig. 4).The density map reconstructed by the deep coordinate network from this 179 region revealed a previously unreported assembly intermediate that we newly call class C4. Like 180 the other class C structures, class C4 lacked the central protuberance, but bore clearly resolved 181 density for helix 68, which was only present in classes E4 and E5 from Davis et al 32 . Traditional 182 voxel-based back-projection of the particle images constituting this cluster reproduced a similar, 183 albeit lower-resolution structure, confirming the existence of this structural state in the original 184 dataset(Supplementary Fig. 6).185 CryoDRGN reveals dynamic continuous motions in the pre-a continuum of conformations 34 . To understand how cryoDRGN would encode 190 such continuous structural heterogeneity in latent space, we first trained a 10D latent variable 191 model on the downsampled images (D=128, Nyquist limit of 8.5 \u00c5) using image poses derived 192 from a consensus reconstruction. Multiple clusters were observed in the latent space encodings 193",
            "latex": null,
            "type": "figure"
        },
        "FIGREF6": {
            "text": "203 undergoing non-cooperative conformational changes. By generating structures along the first 204 principal component of the latent space encodings, we reconstructed a trajectory of the SF3b and 205 helicase domains in motion (Fig. 6d), which smoothly transitioned from an elongated state to one 206 compressed against the body of the spliceosome. A similar traversal along the second PC produced 207 a continuous trajectory of the SF3b and helicase domains moving in opposition (Supplementary 208 Fig. 7). This anticorrelated motion of the SF3b and helicase domains in PC2, together with their 209 correlated motion in PC1, suggested that the two domains move independently in the . By traversing along the k-nearest neighbor graph of the latent encodings and 213 generating structures at the visited nodes, cryoDRGN generated a plausible trajectory of the 214 conformations adopted by the pre-catalytic spliceosome (Supplemental Movie 1), highlighting 215 the potential of single particle cryo-EM to uncover the conformational dynamics introduces cryoDRGN, a new method using neural networks to reconstruct 3D 219 density maps from heterogeneous single particle cryo-EM datasets. The power of this approach 220 lies in its ability to represent heterogeneous structures without simplifying assumptions on the type 221 of heterogeneity. In principle, cryoDRGN is able to represent any distribution of structures that 222 can be approximated by a deep neural network, a broad class of function approximators 35 . This 223 flexibility contrasts with existing methods that impose strong assumptions on the types of 224 structural heterogeneity present in the sample. For example, traditional 3D classification assumes 225 a mixture of discrete structural classes, whereas multibody refinement assumes conformational 226 changes are composed strictly of rigid-body motions. Although these approaches have proven 227 useful, they are inherently unable to model true structural heterogeneity and thus often introduce 228 bias into reconstructions. In contrast, we empirically show that deep coordinate networks can 229 model both discrete compositional heterogeneity and continuous conformational changes without 230 the aforementioned assumptions. For example, by using this less biased approach, we discovered 231 heterogeneous states of the Pf80S ribosome that were originally averaged out of the homogeneous 232 reconstruction. When analyzing the assembling E. Coli LSU dataset, cryoDRGN learned an 233 ensemble of LSU assembly states without a priori specification of the number of states as",
            "latex": null,
            "type": "figure"
        },
        "FIGREF7": {
            "text": "to encoding particles in an unsupervised manner, cryoDRGN can reconstruct 257 3D density maps from user-defined positions in latent space. Because cryoDRGN learns latent space with significant particle occupancy. Indeed, we applied a well-established 262 graph-traversal algorithm 36 to visualize a data-supported path of the Pf80S ribosome, bL17-263 independent assembly of the bacterial ribosome, and the pre-catalytic spliceosome (Supplemental 264 Movies",
            "latex": null,
            "type": "figure"
        },
        "FIGREF8": {
            "text": "The authors thank Ben Demeo, Ashwin Narayan, Adam Lerer, Roy Lederman, Sam Rodriques, Bob Sauer, Phil Sharp, and Kotaro Kelley for helpful discussions and feedback. This work was funded by the National Science Foundation Graduate Research Fellowship Program, NIH grant R01-GM081871 to BB, NIH grant R00-AG050749 to JD, and the MIT J-Clinic for Machine Learning and Health to JD and BB. Author Contributions EZ, TB, BB, and JD conceived of the work. EZ, TB, and BB developed the representation learning method. EZ and JD tailored the method to cryo-EM data, and designed and analyzed the described experiments. EZ implemented the software and performed the experiments. EZ, JD, and BB wrote the manuscript.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF9": {
            "text": "C. et al. Automated molecular microscopy: The new Leginon system. J. Struct. Biol. 151, X. et al. Electron counting and beam-induced motion correction enable nearatomic-resolution single-particle cryo-EM. Nat. Methods 10, 584-590 (2013). 6. Zhang, K. Gctf: Real-time CTF determination and correction. J. Struct. Biol. 193, S. H. W. A Bayesian view on cryo-EM structure determination. J. Mol. Biol. 415, 406-418 (2012). 9. Bepler, T. et al. Positive-unlabeled convolutional neural networks for particle picking in cryo-electron micrographs. Nat Methods 16, 1153-1160 (2019). 10. Ahmed, T., Yin, Z. & Bhushan, S. Cryo-EM structure of the large subunit of the spinach chloroplast ribosome. Sci Rep 6, 1-13 (2016). 11. Wrapp, D. et al. Cryo-EM structure of the 2019-nCoV spike in the prefusion conformation. Science 367, 1260-1263 (2020). 12. Sigworth, F. J. Principles of cryo-EM single-particle image processing. Microscopy (Oxf) 65, 57-67 (2016). 13. Scheres, S. H. W. et al. Maximum-likelihood Multi-reference Refinement for Electron Microscopy Images. J. Mol. Biol. 348, 139-149 (2005). 14. Lyumkis, D., Brilot, A. F., Theobald, D. L. & Grigorieff, N. Likelihood-based classification of cryo-EM images using FREALIGN. J. Struct. Biol. 183, 377-388 (2013).",
            "latex": null,
            "type": "figure"
        },
        "FIGREF11": {
            "text": "30.Punjani, A., Rubinstein, J. L., Fleet, D. J. & Brubaker, M. A. cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination. Nat. Methods 14, 290-296 (2017). 31. Sun, M. et al. Dynamical features of the Plasmodium falciparum ribosome during translation. Nucleic Acids Research 2;43(21):10515-24 (2015). 32. Davis, J. H. et al. Modular Assembly of the Bacterial Large Ribosomal Subunit. Cell 167, 1610-1622.e15 (2016). 33. McInnes, L., Healy, J. & Melville, J. UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. arxiv.org (2018). 34. Plaschka, C., Lin, P.-C. & Nagai, K. Structure of a pre-catalytic spliceosome. Nature 546, 617-621 (2017). 35. Hornik, K. Approximation capabilities of multilayer feedforward networks. Neural Networks 4, 251-257 (1991).",
            "latex": null,
            "type": "figure"
        },
        "FIGREF12": {
            "text": ", C., Bengio, S., Hardt, M., Recht, B. & Vinyals, O. Understanding deep learning requires rethinking generalization. arxiv.org (2016). 38. Buhai, R.-D., Risteski, A., Halpern, Y. & Sontag, D. Benefits of Overparameterization in Single-Layer Latent Variable Generative Models. (2019). 39. Zivanov, J. et al. RELION-3: new tools for automated high-resolution cryo-EM structure determination. bioRxiv 421123 (2018). doi:10.1101/421123 40. Punjani, A., Zhang, H. & Fleet, D. J. Non-uniform refinement: Adaptive regularization improves single particle cryo-EM reconstruction. bioRxiv 179, 2019.12.15.877092 (2019).Methods309The cryoDRGN method310    Deep coordinate networks to represent 3D structure311    The cryoDRGN method performs heterogeneous cryo-EM reconstruction by learning a 312 neural network representation of 3D structure. In particular, we use a neural network to 313 approximate the function : \u211d =>? \u2192 \u211d, which models structures as generated from an n-314 dimensional continuous latent space. We call this architecture 1-3 a deep coordinate network as we 315 explicitly model the volume as a function of Cartesian coordinates. 316 Without loss of generality, we model volumes on the domain [\u22120.5,0.5] = . Instead of 317 directly supplying the 3D Cartesian coordinates, k, to the deep coordinate network, coordinates 318 are featurized with a fixed positional encoding function consisting of sinusoids whose wavelengths 319 follow a geometric progression from 1 up to the Nyquist limit: D is set to the image size 1 used in training. Empirically, we found that excluding the highest 323 frequencies of the positional encoding led to better performance when training on noisy data, and 324 we provide an option to modify the positional encoding function by increasing all representation of 3D structure is learned via an image-encoder/volume-328 decoder architecture based on the variational autoencoder (VAE) 4,5 . We follow the standard image 329 formation model in single particle cryo-EM 3 where observed images are generated from 330 projections of a volume at a random unknown orientation, \u2208 (3). We use an additive 331 Gaussian white noise model. Volume heterogeneity is generated from a continuous latent space, 332 modeled by the latent variable , where the dimensionality of is a hyperparameter of the model. 333 Given an image , the variational encoder, g ( | ), produces a mean and variance, |i 334 and \u03a3 |i , statistics that parameterize a Gaussian distribution with diagonal covariance, as the 335 variational approximation to the true posterior ( | ). The prior on the latent variable is a standard 336 normal distribution (0, ). The deep coordinate network architecture is used as the probabilistic 337 decoder, m ( | , ), and models structures in frequency space. Given Cartesian coordinate \u2208 338 \u211d = and latent variable , the probabilistic decoder predicts a Gaussian distribution over ( , ).",
            "latex": null,
            "type": "figure"
        },
        "FIGREF13": {
            "text": "Number of pixels along one dimension of the image, i.e. a \u00d7 image coordinates for a given image can be obtained by rotating a \u00d7 lattice spanning343    [\u22120.5,0.5] G originally on the x-y plane by , the orientation of the volume during imaging. Then,344    given a sample out of g ( | ) and the oriented coordinates, an image can be reconstructed pixel-345 by-pixel through the decoder. The reconstructed image is then translated by the image's in-plane 346 shift, and the CTF is applied before it is compared to the input image. The negative log likelihood 347 of a given image under our model is computed as the mean square error between the reconstructed 348 image and the input image. Following the standard VAE framework, the optimization objective is 349 the variational lower bound of the model evidence: 350 \u2112( ; , ) = s t ( |i) [log ( | )] \u2212 I g ( | )\u2016 ( )L 351 where the first term is the reconstruction error estimated with one Monte Carlo sample and the 352 second term is a regularization term on the latent representation. By training on many 2D slices 353 with sufficiently diverse orientations, the 3D volume can be learned through feedback from the 2D 354 views. For further details, we refer the reader to a preliminary version of the method described in 355 the proceedings of the International Conference for Learning Representations 3 . The results 356 presented here employ the training regime described in Zhong et al. subunit of the E. coli ribosome was extracted from PDB 4YBB in PyMOL 7 . A 361 density map was generated from the atomic model using the molmap command in Chimera 8 at a 362 grid spacing of 1.5 \u00c5/pix and a resolution of 4.5 \u00c5. The resulting volume was padded to a and shifting the image with an in-plane translation sampled uniformly from [-20,20] 2 pixels. 367 Projection images were multiplied with the CTF in Fourier space, where the CTF was computed 368 from defocus values randomly sampled from those given in EMPIAR-10028, no astigmatism, an 369 accelerating voltage of 300 kV, a spherical aberration of 2mm, and an amplitude contrast ratio of 370 0.1. An envelope function with a B-factor of 100 \u00c5 2 was applied. Noise was added with a signal 371 to noise ratio (SNR) of 0.1 where the noise-free signal images were defined as the entire DxD 372 image. To generate the dataset with D=128, the D=256 noiseless projection images of the 50S 373were downsampled by Fourier clipping, followed by addition of CTF and noise as above.374Discrete3 heterogeneous dataset generation375    To generate the \"Discrete3\" dataset, 10k, 15k, and 25k simulated micrographs of the 30S, 376 50S, and 70S ribosome, respectively, were combined. 15k micrographs from the homogeneous 377 50S dataset were used, and micrographs of the 30S and 70S ribosome were generated using the 378 same procedure starting from the atomic model extracted from PDB 4YBB, and extracting either 379 the 30S or 70S subunits. Images were downsampled to D=128, corresponding to a the \"Linear1D\" dataset, 50 density maps were generated along a reaction 383 coordinate defined by rotation of a dihedral angle in an atomic model of a hypothetical protein 384 complex. Each model was generated at 0.03 radian increments of the bond rotation, leading to a 385 total range of 1.5 radians. Density maps were generated in Chimera at a grid spacing of 6 \u00c5/pix 386 and resolution of 12 \u00c5, and padded to a box size of D=128. 1000 projection images were",
            "latex": null,
            "type": "figure"
        },
        "FIGREF14": {
            "text": "Latent space graph traversal for generating trajectories507    Trajectories were generated by first creating a nearest-neighbors graph from the latent 508 encodings of the images, where a neighbor was defined if the Euclidean distance was below a 509 threshold computed from the statistics of all pairwise distances. We choose a value such that the 510 average number of neighbors across all nodes is 5. Edges were then pruned such that a given node 511 does not have more than 10 neighbors. Then, Djikstra's algorithm was used to find the shortest 512 path along the graph connecting a series of anchor points, and density maps were generated at the 513 value of the visited nodes. Anchor points were set to be the \"on-data\" cluster centers after 514 performing k-means clustering of the latent encodings with k=20. Instead of using the mean value 515 of each k-means cluster, we define the latent encoding closest in Euclidean distance to the k-means 516 cluster center as the \"on-data\" cluster center.517    To generate Supplemental Movie 1 of the 80S ribosome, 113 density maps were generated 518 by following the protocol above, and we visualized a representative sequence of 60 density maps 519 that contained the 40S rotated state. To generate Supplemental Movies 2 and 3 of the assembling 520 bacterial LSU, anchor points were manually chosen from an interactive tool provided in 521 cryoDRGN to create a path along the C-class assembly pathway and the D-class assembly 522 pathway. To generate Supplemental Movie 4 of the pre-catalytic spliceosome, 132 density maps 523 were generated following the above protocol. The cryoDRGN method for heterogeneous single particle cryo-EM reconstruction.535 a) A deep coordinate network approximates a molecule's density as a function of featurized 3D 536 Cartesian coordinates and continuous latent variables, , which define a continuous manifold of 537 heterogeneous structures. b) The overall cryoDRGN training framework consists of two neural 538 networks structured in an encoder/decoder architecture. Data is represented in the Fourier domain 539 in order to relate 2D images as slices out of the 3D density map. During training, an input image 540 is encoded in latent space by the encoder network (E). A 2D lattice is rotated by the image's 541 previously determined pose, , to represent the 3D coordinates of the image slice. Given the 542 coordinates and a sample of the predicted latent variable , the image is reconstructed pixel-by-543 pixel through the decoder (D), i.e. the deep coordinate network. The loss function is a variational 544 upper bound on the data likelihood and consists of the image reconstruction error and latent loss 545 (red arrows), which is used to update neural network weights by stochastic gradient descent (blue 546 arrows",
            "latex": null,
            "type": "figure"
        },
        "FIGREF15": {
            "text": "Deep coordinate network representation of static structure. a) Reconstructed density 552 map produced by a deep coordinate network with 10 hidden layers of dimension 1024 trained on 553 particle images from EMPIAR 10028 29 (D=360, Nyquist limit of 2.7 \u00c5) and a traditional 554 homogeneous reconstruction in cryoSPARC 29 . b) Fourier shell correlation (FSC) curves between 555 the density map produced by deep coordinate networks of varying architectures (nodes x hidden 556 layers) and the traditional homogeneous reconstruction in (a) after 25 epochs of training. c) 557 Average loss over the dataset during training deep coordinate networks of varying CryoDRGN heterogeneous reconstruction of simulated datasets with continuous 564 and discrete heterogeneity. a) Ground truth density maps sampled along a reaction coordinate 565 that describes the transition from the leftmost to rightmost structure used to simulate a dataset with 566 continuous heterogeneity. b) Predicted latent encoding for each image of the dataset from (a) after 567 training a cryoDRGN 1D latent variable model versus the ground truth reaction coordinate 568 describing the motion (Spearman = \u22120.996). c) Reconstructed structures at specified values of 569 the latent variable, shown as dotted lines in (b). d) Ground truth density maps of the bacterial 30S, 570 50S, and 70S ribosome used to simulate a dataset with discrete heterogeneity. e) Predicted latent 571 encoding for each particle image of (d) variable after training a cryoDRGN 1D latent variable 572 model vs. its ground truth class assignment (classification accuracy of 99.9%). f) Reconstructed 573 structures at specified values of the latent variable from (e).",
            "latex": null,
            "type": "figure"
        },
        "FIGREF16": {
            "text": "CryoDRGN heterogeneous reconstruction of the Pf80S ribosome. a) PCA projection 576 of latent space encodings after training a 10D latent variable model on particle images from 577 EMPAIR-10028 29 . b) Three representative density maps that were reconstructed at the points 578 depicted in (a) are shown with a docked atomic model (PDB 3J79, 3J7A) of the 40S (blue). The 579 red arrow highlights the missing 40S head group, and the blue arrow depicts the rotation of the 580 40S relative to the 60S. c) Additional views of the structures shown in (b), with atomic model of 581 the 60S colored in orange. The cyan arrow notes the presence of an additional RNA helix not 582 present in the homogeneous reconstruction, and the red arrow notes the disappearance of the C-583 terminus of eL8 in the rotated state. CryoDRGN heterogeneous reconstruction of the assembling large ribosomal 586 subunit from E. coli. a) Histograms of latent encodings of particle images from EMPIAR 10076 32 587 after training a cryoDRGN 1D latent variable model. Overlaid histograms are shown for particles 588 from each published major class assignments from Davis et al 31 . A cutoff of = \u22121 was used to 589 filter impurities from the dataset for subsequent analyses. Example image of an ice artifact 590 predicted at = \u22122. b) UMAP visualization of latent encodings after training a cryoDRGN 10D 591 latent variable model, colored by the published major class assignments 32 . c) CryoDRGN 592 reconstructed density maps of the major assembly states of the LSU generated from points B-E 593 shown in (b) along with a docked atomic model (PDB 4YBB). CryoDRGN heterogeneous reconstruction of the pre-catalytic spliceosome. a) 596 UMAP visualization of latent encodings after training a 10D latent variable model with cryoDRGN 597 on EMPIAR 10180 33 , before (top) and after (bottom) particle filtering. b) Representative structures 598 generated at points shown in (a) which depict the expected structures (i,ii), broken particles (iii), 599 particles with apparent aggregation (iv), and the complex lacking the SF3b domain (v). c) PCA 600 projection of latent space encodings after training a 10D latent variable model on the filtered 601 images. d) Structures generated by traversing along PC1 of the latent space encodings at",
            "latex": null,
            "type": "figure"
        },
        "TABREF0": {
            "text": "CryoDRGN performs heterogeneous reconstruction by learning a neural network",
            "latex": null,
            "type": "table"
        },
        "TABREF1": {
            "text": ". The full distribution of latent encodings can then be visualized to study the latent space data manifold.",
            "latex": null,
            "type": "table"
        },
        "TABREF2": {
            "text": ").We next used simulated single particle cryo-EM datasets to test if the complete cryoDRGN 94 framework could perform heterogeneous reconstruction. This simulation-based approach allowed 95 us to quantitatively evaluate the method's performance by comparing the reconstructed density 96 maps to the ground truth density maps. To simulate continuous motions, we constructed an atomic 97 model of a hypothetical protein complex and iteratively rotated one bond's dihedral angle,",
            "latex": null,
            "type": "table"
        },
        "TABREF3": {
            "text": "continuous heterogeneity by Laplacian spectral volumes. arXiv.org eess.IV, (2019). 20. Lederman, R. R. & Singer, A. Continuously heterogeneous hyper-objects in cryo-EM and 3-D movies of many temporal dimensions. arXiv.org cs.CV, (2017).",
            "latex": null,
            "type": "table"
        },
        "TABREF4": {
            "text": "). c) After training, the encoder can be used to visualize the dataset's distribution in latent 547 space (manifold visualization), and the decoder can be used to directly reconstruct structures at 548 arbitrary points from the latent code. Example micrographs and reconstructed density maps from 549 EMPIAR 10076 32 . BY-NC-ND 4.0 International license author/funder. It is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint Determination of highly heterogeneous molecular structures",
            "latex": null,
            "type": "table"
        }
    },
    "back_matter": [
        {
            "text": "The authors declare no competing financial interests.with random orientations and in-plane translations from [-10,10] 2 pixels for each map leading to a 388 final particle stack of 50k images. CTF and noise at an SNR=0.1 were added using the same 389 procedure described above. 390 Real cryo-EM datasets 391 Processed shiny particles and the star file containing CTF parameters were downloaded 392 from the Electron Microscopy Public Image Archive (EMPIAR) 9 The copyright holder for this preprint (which was not peer-reviewed) is the . https://doi.org/10.1101/2020.03.27.003871 doi: bioRxiv preprint",
            "cite_spans": [
                {
                    "start": 278,
                    "end": 281,
                    "text": "390",
                    "ref_id": null
                },
                {
                    "start": 304,
                    "end": 307,
                    "text": "391",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Competing Interests Statement"
        }
    ]
}